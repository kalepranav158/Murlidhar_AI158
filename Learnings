Audio callbacks are contracts.
DSP algorithms require fixed frame sizes.


ğŸ¼ MUSICAL INSIGHT (THIS IS KEY)
A note should be accepted when:
â€œThe pitch stays the same continuously for â‰¥ MIN_NOTE_DURATIONâ€
NOT:
â€œThere are two frames with same noteâ€
â€œThe note didnâ€™t change backâ€
So we need:
A candidate note
A candidate start time
Confirmation only after duration is met
This requires a 2-state machine, not a single variable.